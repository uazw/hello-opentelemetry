services:
  helloworld:
    image: eclipse-temurin:21
    environment:
      # - OTEL_EXPORTER_OTLP_PROTOCOL=http/protobuf
      - OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
      - OTEL_EXPORTER_OTLP_PROTOCOL=grpc
      # - OTEL_EXPORTER_OTLP_METRICS_ENDPOINT=http://prometheus:9090/api/v1/otlp/v1/metrics
      - OTEL_METRICS_EXPORTER=none
      - OTEL_LOGS_EXPORTER=none
      - OTEL_SERVICE_NAME="helloworld"
      - OTEL_RESOURCE_ATTRIBUTES="service.instance.id=123"
      - JAVA_TOOL_OPTIONS="-javaagent:/app/opentelemetry-javaagent.jar"
    ports:
      - "8080:8080"
    volumes:
      - ./build/libs/hello-world-0.0.1-SNAPSHOT.jar:/app/helloworld.jar
      - ./opentelemetry-javaagent-2.16.0.jar:/app/opentelemetry-javaagent.jar
    working_dir: /app
    command: java -jar helloworld.jar 
    depends_on:
      - jaeger
    network_mode: "host"

  # prometheus:
  #   image: prom/prometheus
  #   ports:
  #     - "9090:9090"
  #   volumes:
  #     - prometheus-data:/prometheus
  #     - ./prometheus-otlp.yml:/prometheus/prometheus-otlp.yml
  #   command: '--config.file=/prometheus/prometheus-otlp.yml --web.enable-otlp-receiver'

  jaeger:
    image: jaegertracing/all-in-one:latest
    ports:
      - "16686:16686"  # Jaeger UI
      - "4317:4317"
      - "4318:4318"
      - "5778:5778"
      - "9411:9411"
    network_mode: "host"

volumes:
  prometheus-data:
